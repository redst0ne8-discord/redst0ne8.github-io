<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Texas Hold'em Public View</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            display: flex; 
            flex-direction: column;
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            background-color: #006000;
            color: white;
            overflow: hidden;
            position: relative;
        }

        h1 { font-size: 3em; margin-bottom: 40px; }

        .winner-banner {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1.5em;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.6);
            border: 3px solid #ff8c00;
            z-index: 100;
            text-align: center;
            animation: winnerPulse 2s infinite;
        }

        @keyframes winnerPulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.05); }
        }

        .winner-banner .winner-name {
            font-size: 1.3em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .winner-banner .winner-hand {
            font-size: 0.8em;
            margin-top: 5px;
            color: #333;
        }

        .board { 
            display: flex; 
            gap: 20px; 
            padding: 30px; 
            border: 5px solid #a0a0a0; 
            border-radius: 15px; 
            background-color: #008000;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            z-index: 10;
            position: relative;
        }

        .pot-display {
            position: absolute;
            bottom: -60px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.9);
            color: #ffd700;
            padding: 12px 30px;
            border-radius: 10px;
            border: 3px solid #ffd700;
            font-size: 1.5em;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
            white-space: nowrap;
        }

        .pot-display .pot-label {
            font-size: 0.7em;
            color: #ccc;
            display: block;
        }

        .card-container {
            display: flex;
            gap: 10px;
            position: relative;
        }

        .card {
            width: 100px;
            height: 150px;
            background-color: white;
            border: 1px solid #333;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5em;
            font-weight: bold;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
            transition: background-color 0.5s, color 0.5s;
        }

        .hidden {
            background-color: #333;
            color: transparent;
            font-size: 0;
            border: 5px solid gold;
        }

        .red-suit { color: red; }
        .black-suit { color: black; }

        .stage-divider {
            width: 1px;
            background-color: rgba(255, 255, 255, 0.5);
            margin: 0 10px;
        }

        .stage-label {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8em;
            font-weight: bold;
            color: #ccc;
            white-space: nowrap;
        }

        .player-area {
            position: absolute;
            width: 140px;
            padding: 12px;
            background-color: rgba(30, 30, 30, 0.95);
            border-radius: 10px;
            border: 3px solid #555;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.6);
            transition: all 0.3s ease-out;
            z-index: 5;
        }

        .player-area.active {
            border-color: #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.8);
            background-color: rgba(0, 50, 0, 0.95);
        }

        .player-area.winner {
            border-color: #ffd700;
            box-shadow: 0 0 25px rgba(255, 215, 0, 1);
            background-color: rgba(50, 40, 0, 0.95);
        }

        .player-area.folded {
            opacity: 0.4;
            border-color: #888;
        }

        .player-name {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 8px;
            color: #ffffff;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        .player-area.active .player-name {
            color: #00ff00;
        }

        .player-area.winner .player-name {
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(255, 215, 0, 0.8);
        }

        .player-balance {
            font-size: 1em;
            color: #fff;
            background-color: #1a1a1a;
            padding: 6px 10px;
            border-radius: 5px;
            display: block;
            margin-top: 5px;
            border: 1px solid #444;
        }

        .player-cards {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin-top: 8px;
        }

        .player-card {
            width: 35px;
            height: 50px;
            background-color: white;
            border: 1px solid #333;
            border-radius: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2em;
            font-weight: bold;
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }

        .player-card.hidden {
            background-color: #333;
            color: transparent;
            border: 2px solid gold;
        }

        .player-action {
            margin-top: 8px;
            padding: 6px 10px;
            border-radius: 5px;
            font-size: 0.95em;
            font-weight: bold;
            text-transform: uppercase;
            border: 2px solid;
        }

        .action-check {
            background-color: #333;
            border-color: #666;
            color: #ccc;
        }

        .action-call {
            background-color: #0066cc;
            border-color: #0088ff;
            color: white;
        }

        .action-raise {
            background-color: #ff8800;
            border-color: #ffaa00;
            color: white;
        }

        .action-fold {
            background-color: #cc0000;
            border-color: #ff0000;
            color: white;
        }

    </style>
</head>
<body>

    <div id="winner-banner-container"></div>
    
    <div id="configMessage" style="display: none; font-size: 2em; text-align: center;">
        Configuration in progress...
    </div>

    <div id="gameBoard">
    <h1>Texas Hold'em Board</h1>

    <div class="board">
        <div class="card-container">
            <span class="stage-label">FLOP</span>
            <div id="displayFlop1" class="card hidden"></div>
            <div id="displayFlop2" class="card hidden"></div>
            <div id="displayFlop3" class="card hidden"></div>
        </div>
        
        <div class="stage-divider"></div>

        <div class="card-container">
            <span class="stage-label">TURN</span>
            <div id="displayTurn" class="card hidden"></div>
        </div>

        <div class="stage-divider"></div>

        <div class="card-container">
            <span class="stage-label">RIVER</span>
            <div id="displayRiver" class="card hidden"></div>
        </div>

        <div class="pot-display">
            <span class="pot-label">POT</span>
            $<span id="potAmount">0</span>
        </div>
    </div>

    <div id="players-container"></div>
    </div>

    <script>
        function getCardSuit(card) {
            return card.slice(-1);
        }

        function getCardRank(card) {
            return card.slice(0, -1);
        }

        function getSuitClass(suit) {
            return (suit === '‚ô•' || suit === '‚ô¶') ? 'red-suit' : 'black-suit';
        }

        function positionPlayers(players, currentTurn, winnerId) {
            const container = document.getElementById('players-container');
            container.innerHTML = '';

            if (!players || players.length === 0) return;

            const tableCenterX = window.innerWidth / 2;
            const tableCenterY = window.innerHeight / 2;

            const ellipseRadiusX = window.innerWidth * 0.42; 
            const ellipseRadiusY = window.innerHeight * 0.42;
            
            const playerWidth = 164;
            const playerHeight = 160;

            players.forEach((player, i) => {
                const angle = (i / players.length) * 2 * Math.PI;

                const x = tableCenterX + ellipseRadiusX * Math.cos(angle) - (playerWidth / 2);
                const y = tableCenterY + ellipseRadiusY * Math.sin(angle) - (playerHeight / 2);

                const isActive = currentTurn === player.id;
                const isWinner = winnerId === player.id;
                const playerDiv = document.createElement('div');
                playerDiv.className = `player-area ${isActive ? 'active' : ''} ${isWinner ? 'winner' : ''} ${player.folded ? 'folded' : ''}`;
                playerDiv.id = `player-display-${player.id}`;
                playerDiv.style.left = `${x}px`;
                playerDiv.style.top = `${y}px`;
                
                // Player cards HTML
                let cardsHTML = '<div class="player-cards">';
                
                // Check if player has card data (for backwards compatibility)
                const hasCard1 = player.card1 !== undefined && player.card1 !== '--- Select Card ---';
                const hasCard2 = player.card2 !== undefined && player.card2 !== '--- Select Card ---';
                const cardsRevealed = player.cardsRevealed === true;
                
                if (!cardsRevealed || !hasCard1) {
                    cardsHTML += '<div class="player-card hidden"></div>';
                } else {
                    const suit1 = getCardSuit(player.card1);
                    const suitClass1 = getSuitClass(suit1);
                    cardsHTML += `<div class="player-card ${suitClass1}">${player.card1}</div>`;
                }
                
                if (!cardsRevealed || !hasCard2) {
                    cardsHTML += '<div class="player-card hidden"></div>';
                } else {
                    const suit2 = getCardSuit(player.card2);
                    const suitClass2 = getSuitClass(suit2);
                    cardsHTML += `<div class="player-card ${suitClass2}">${player.card2}</div>`;
                }
                cardsHTML += '</div>';
                
                let actionHTML = '';
                if (player.action && !player.folded) {
                    let actionText = player.action.toUpperCase();
                    if (player.action === 'call' && player.actionValue > 0) {
                        actionText += ` $${player.actionValue}`;
                    } else if (player.action === 'raise' && player.actionValue > 0) {
                        actionText += ` $${player.actionValue}`;
                    }
                    actionHTML = `<div class="player-action action-${player.action}">${actionText}</div>`;
                } else if (player.folded) {
                    actionHTML = `<div class="player-action action-fold">FOLDED</div>`;
                }
                
                playerDiv.innerHTML = `
                    <div class="player-name">${player.name}</div>
                    ${cardsHTML}
                    <div class="player-balance">$${player.balance.toLocaleString()}</div>
                    ${actionHTML}
                `;
                container.appendChild(playerDiv);
            });
        }

        function updateView() {
            const stateJSON = localStorage.getItem('pokerState');
            let pokerState;
            
            if (!stateJSON) {
                pokerState = {
                    flop1: '--- Select Card ---',
                    flop2: '--- Select Card ---',
                    flop3: '--- Select Card ---',
                    turn: '--- Select Card ---',
                    river: '--- Select Card ---',
                    isFlopRevealed: false,
                    isTurnRevealed: false,
                    isRiverRevealed: false,
                    players: [],
                    currentTurn: null,
                    winner: null,
                    winningHand: null,
                    pot: 0,
                    configuring: true
                };
            } else {
                pokerState = JSON.parse(stateJSON);
            }

            // Check if configuration is in progress
            if (pokerState.configuring === undefined || pokerState.configuring === true) {
                document.getElementById('configMessage').style.display = 'block';
                document.getElementById('gameBoard').style.display = 'none';
                return;
            } else {
                document.getElementById('configMessage').style.display = 'none';
                document.getElementById('gameBoard').style.display = 'block';
            }

            // Update pot display
            const potDisplay = document.getElementById('potAmount');
            if (potDisplay) {
                potDisplay.textContent = (pokerState.pot || 0).toLocaleString();
            }

            // Update winner banner
            const bannerContainer = document.getElementById('winner-banner-container');
            if (pokerState.winner && pokerState.winningHand) {
                const winnerPlayer = pokerState.players.find(p => p.id === pokerState.winner);
                if (winnerPlayer) {
                    bannerContainer.innerHTML = `
                        <div class="winner-banner">
                            <div class="winner-name">üèÜ ${winnerPlayer.name} WINS! üèÜ</div>
                            <div class="winner-hand">${pokerState.winningHand}</div>
                        </div>
                    `;
                }
            } else {
                bannerContainer.innerHTML = '';
            }

            if (pokerState.players && pokerState.players.length > 0) {
                positionPlayers(pokerState.players, pokerState.currentTurn, pokerState.winner);
            } else {
                positionPlayers([], null, null);
            }

            const flopCards = [
                { id: 'displayFlop1', value: pokerState.flop1 },
                { id: 'displayFlop2', value: pokerState.flop2 },
                { id: 'displayFlop3', value: pokerState.flop3 }
            ];

            flopCards.forEach(card => {
                const element = document.getElementById(card.id);
                const isHidden = !pokerState.isFlopRevealed || card.value === '--- Select Card ---';
                element.className = 'card';
                
                if (!isHidden) {
                    const suit = getCardSuit(card.value);
                    element.textContent = card.value;
                    element.classList.add(getSuitClass(suit));
                } else {
                    element.textContent = '';
                    element.classList.add('hidden');
                }
            });

            const turnElement = document.getElementById('displayTurn');
            const isTurnHidden = !pokerState.isTurnRevealed || pokerState.turn === '--- Select Card ---';
            turnElement.className = 'card';

            if (!isTurnHidden) {
                const suit = getCardSuit(pokerState.turn);
                turnElement.textContent = pokerState.turn;
                turnElement.classList.add(getSuitClass(suit));
            } else {
                turnElement.textContent = '';
                turnElement.classList.add('hidden');
            }

            const riverElement = document.getElementById('displayRiver');
            const isRiverHidden = !pokerState.isRiverRevealed || pokerState.river === '--- Select Card ---';
            riverElement.className = 'card';

            if (!isRiverHidden) {
                const suit = getCardSuit(pokerState.river);
                riverElement.textContent = pokerState.river;
                riverElement.classList.add(getSuitClass(suit));
            } else {
                riverElement.textContent = '';
                riverElement.classList.add('hidden');
            }
        }

        setInterval(updateView, 200);

        updateView();
        
        window.addEventListener('resize', () => {
            const stateJSON = localStorage.getItem('pokerState');
            if (stateJSON) {
                const pokerState = JSON.parse(stateJSON);
                if (!pokerState.configuring && pokerState.players && pokerState.players.length > 0) {
                    positionPlayers(pokerState.players, pokerState.currentTurn, pokerState.winner);
                }
            }
        });
    </script>
</body>
</html>